<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>聊天室</title>

<link type="text/css" href="/css/bootstrap.min.css" rel="stylesheet">
<script type="text/javascript" src="/js/jquery.min.js"></script>
<script type="text/javascript" src="/js/clipboard.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>

<script type="text/javascript">
	//连接对象
	var websocket = null;
	var name = null;

	//建立连接
	function connectWebsocket(argument) {
		name = Math.random();
		//先判断浏览器是否支持webscoket
		if ("websocket" in window) {
			websocket = new WebSocket("ws://" + window.location.hostname
					+ ":8080/websocket/" + name);
		} else {
			alert("浏览器不支持");
			return false;
		}
		//建立连接成功的方法
		websocket.onopen = function(event) {
			setMessage("提示：连接成功");
		}
		websocket.onclose = function(event) {
			setMessage("提示：连接关闭");
		}
		websocket.onmessage = function(event) {
			setMessage(event.data);
		}
		websocket.onerror = function(event) {
			setMessage("提示：连接异常");
		}
	}

	// 连接成功打印的消息
	function setMessage(msg) {
		var data = JSON.parse(msg);
		var message = document.getElementById('message');
	    message.innerHTML += '<div class="alert alert-success '+  (data.name == name? 'right-msg':'left-msg')+'" ondblclick="copyMeaassge()" role="alert">'
					+ data.msg + "</div>";
	 
	}
	function copyMeaassge() {
		var message = $(event.target).text();
		var  clipboard = new ClipboardJS(event.target, {
			text : function(trigger) {
				return message;
			}
		});
		clipboard.on('success', function(e) {
			$(".tip-div").html("复制成功").show(500).delay(2000).hide(500);
			clipboard.destroy();
		});
	}
	//发送消息
	function send() {
		var message = $("#send-div input").val();
		$("#send-div input").val("");
		//var pindao = document.getElementById("pindao").value;
		var pindao = "";
		var socketMsg = {
			message : message,
			toUser : pindao
		}
		if (pindao == "") {
			socketMsg.type = 0;//群聊
		} else {
			socketMsg.type = 1;//单聊
		}
		// websocket.send(name+":"+message);
		websocket.send(JSON.stringify(socketMsg));//将json对象转换为json字符串
	}
	function closeWebsocket() {
		websocket.close();
	}

	window.onload = connectWebsocket;
	//监听窗口关闭事件，窗口关闭，连接关闭
	window.onbeforeunload = function() {
		websocket.close();
	}
 
</script>
</head>
<body>

	<div class="alert  alert-success tip-div" role="alert"></div>
	<div id="main-div">
		<div id="message"></div>
		<div id="send-div">
			<input type="text" class="form-control">
			<button type="button" onclick="send()" class="btn btn-default">send</button>
		</div>
	</div>
</body>
<style type="text/css">
html, body {
	height: 100%;
}

.tip-div {
	position: absolute;
	left: 50%;
	top: 20px;
	transform: translate(-50%, -50%);
	text-align: center;
	max-width: 200px !important;
	width: 30% !important;
	display: none;
	border: 1px solid red;
}

#main-div {
	margin: 0 auto;
	width: 100%;
	height: 100%;
	max-width: 900px;
	overflow: hidden;
}

#message {
	padding: 10px;
	border: 1px solid red;
	overflow-y: auto;
	border-radius: 2px;
	height: calc(100% - 44px);
}

#send-div {
	display: flex;
	flex-direction: row;
	height: 34px;
	padding: 5px 0 5px 0;
}

#send-div input {
	width: 90%;
}

#send-div button {
	width: 10%;
	min-width: 60px;
	height: 34px;
}

.alert {
	margin: 0 auto;
	margin-top: 10px;
	padding: 8px;
	width: auto;
	max-width: 70%;
	clear: both;
	word-wrap: break-word;
	word-break: break-all;
}

.right-msg {
	float: right;
}

.left-msg {
	float: left;
}
</style>
</html>